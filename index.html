<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Software Portal - Login</title>
<style>
body {
    background: linear-gradient(135deg, #001f3f, #000000);
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    color: white;
    font-family: Arial, sans-serif;
}
.login-container {
    background: rgba(0,0,0,0.85);
    padding: 40px;
    border-radius: 15px;
    box-shadow: 0 0 20px #00ffff, 0 0 40px #00ffff inset;
    text-align: center;
    width: 350px;
}
h1 {
    text-shadow: 0 0 10px #00ffff;
    margin-bottom: 25px;
}
input, button {
    width: 100%;
    padding: 12px;
    margin: 10px 0;
    border-radius: 8px;
    border: none;
    font-size: 16px;
}
button {
    background: linear-gradient(45deg, #001f3f, #000000);
    color: #fff;
    font-weight: bold;
    text-shadow: 0 0 5px #00ffff;
    cursor: pointer;
    box-shadow: 0 0 10px #00ffff, 0 0 20px #00ffff inset;
    transition: 0.3s;
}
button:hover {
    transform: scale(1.05);
    box-shadow: 0 0 20px #00ffff, 0 0 40px #00ffff inset;
}
.message {
    margin-top: 15px;
    font-weight: bold;
    color: lime;
}
.contact {
    margin-top: 10px;
    font-size: 14px;
}
.contact a {
    color: #00ffff;
    text-decoration: none;
}
.contact a:hover {
    text-decoration: underline;
}
</style>
</head>

<body>

<div class="login-container">
  <h1>Login</h1>
  <input type="text" id="passwordInput" placeholder="Enter your password only">
  <button id="loginBtn">Login</button>
  <div class="message" id="message"></div>
  <div class="contact">Contact <a href="https://t.me/baccarat0987" target="_blank">t.me/baccarat0987</a></div>
</div>

<script type="module">
import { db, collection, getDocs, query, where, Timestamp } from './firebase.js';

const passwordInput = document.getElementById('passwordInput');
const loginBtn = document.getElementById('loginBtn');
const message = document.getElementById('message');

loginBtn.addEventListener('click', async () => {
    const password = passwordInput.value.trim();
    if(!password) {
        message.style.color = "red";
        message.textContent = "Enter a password!";
        return;
    }

    try {
        const q = query(collection(db, "memberPasswords"), where("password", "==", password));
        const querySnapshot = await getDocs(q);

        if(querySnapshot.empty) {
            message.style.color = "red";
            message.textContent = "Invalid password!";
            return;
        }

        const docData = querySnapshot.docs[0].data();

        // Check expiration
        if(docData.expiresAt && docData.expiresAt.toDate() < new Date()) {
            message.style.color = "red";
            message.textContent = "This password has expired!";
            return;
        }

        // âœ… Store session in browser
        sessionStorage.setItem("loggedApp", docData.app);
        if(docData.expiresAt) {
            sessionStorage.setItem("expiresAt", docData.expiresAt.toDate());
        } else {
            sessionStorage.removeItem("expiresAt"); // LIFETIME password
        }

        message.style.color = "lime";
        message.textContent = "Login successful! Redirecting...";

        // Redirect to the correct app
        setTimeout(() => {
            window.location.href = `${docData.app}.html`;
        }, 1000);

    } catch(err) {
        message.style.color = "red";
        message.textContent = "Error: " + err.message;
    }
});
</script>

</body>
</html>
