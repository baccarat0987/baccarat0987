<!DOCTYPE html>
<html>
<head>
<title>Software Portal Login</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="firebase.js"></script>

<style>
body { background:#111; color:white; text-align:center; font-family:Arial; margin-top:100px; }
input, button { padding:10px; font-size:16px; }
</style>
</head>
<body>

<h2>Enter Password</h2>

<input type="text" id="loginPassword" placeholder="Enter Password">
<br><br>
<button onclick="login()">Login</button>

<script>
async function login(){

    const enteredPassword = document.getElementById("loginPassword").value;

    if(!enteredPassword){
        alert("Enter password");
        return;
    }

    const snapshot = await db.collection("memberPasswords")
        .where("password", "==", enteredPassword)
        .get();

    if(snapshot.empty){
        alert("Invalid Password");
        return;
    }

    let validLogin = false;

    snapshot.forEach(doc => {

        const data = doc.data();

        if(!data.expiresAt){
            validLogin = true;
            window.location.href = data.app + ".html";
        } else {
            const now = new Date();
            const expireDate = data.expiresAt.toDate();

            if(expireDate > now){
                validLogin = true;
                window.location.href = data.app + ".html";
            }
        }
    });

    if(!validLogin){
        alert("Password Expired");
    }
}
</script>

</body>
</html>
