<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>VisionWave Baccarat</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <style>
    /* ... your existing styles ... */
  </style>
</head>
<body>

<!-- =========================
   SESSION CHECK SCRIPT
========================== -->
<script>
  // âœ… SESSION CHECK
  const loggedIn = localStorage.getItem('loggedIn');
  const allowedApp = localStorage.getItem('allowedApp');
  const expiresAt = Number(localStorage.getItem('expiresAt'));

  if (loggedIn !== 'true' || allowedApp !== '0921374sidfy8734sah' || (expiresAt && expiresAt < Date.now())) {
      alert("Please login first!");
      localStorage.removeItem('loggedIn');
      localStorage.removeItem('allowedApp');
      localStorage.removeItem('expiresAt');
      window.location.href = "index.html"; // redirect to login page
  }
</script>

<div class="container" id="app">
  <div class="title">VisionWave Baccarat PRO</div>
  <div class="progress-wrap" id="progressContainer">
    <div class="progress-bar-outer"><div class="progress-bar" id="progressBar"></div></div>
    <div class="progress-text" id="progressText">0% - Record 25 entries to calculate prediction</div>
  </div>
  <div class="history" id="historyArea">
    <div id="historyDisplay" style="display:flex;gap:8px;flex-wrap:wrap;align-items:center;justify-content:center"></div>
  </div>
  <div class="prediction" id="predictionCard"> 
   <div class="pred" id="predictionText"></div>
    <div class="suggestion" id="suggestionText"></div>
  </div>
  <div class="message" id="messageArea"></div>
  <div class="controls" id="controlsRow">
    <button class="btn-p" id="btnP"><i class="fas fa-user"></i> Player</button>
    <button class="btn-b" id="btnB"><i class="fas fa-landmark"></i> Banker</button>
    <button class="btn-undo" id="btnUndo"><i class="fas fa-undo"></i> Undo</button>
    <button class="btn-reset" id="btnReset"><i class="fas fa-redo"></i> Reset</button>
  </div>
</div>

<script>
  // ======= Your existing Baccarat JS logic =======
  (function(){
      const MAX_ENTRIES = 25, steps = [100,200,600,1400,3000,6200];
      let hist = [], step = 0, pred = "", done = false, undoStack = [];

      const bar = document.getElementById("progressBar"),
            barTxt = document.getElementById("progressText"),
            histDisp = document.getElementById("historyDisplay"),
            predCard = document.getElementById("predictionCard"),
            predTxt = document.getElementById("predictionText"),
            suggTxt = document.getElementById("suggestionText"),
            msg = document.getElementById("messageArea"),
            ctr = document.getElementById("controlsRow"),
            prog = document.getElementById("progressContainer"),
            histBox = document.getElementById("historyArea");

      function snap(){ return { h:[...hist], step, pred, done, ui:{ w:bar.style.width,t:barTxt.textContent,h:histDisp.innerHTML, show:predCard.style.display,text:predTxt.textContent,sug:suggTxt.textContent,msg:msg.innerHTML,ctrl:ctr.innerHTML,prog:prog.style.display,his:histBox.style.display } }; }
      function restore(s){ hist=[...s.h]; step=s.step; pred=s.pred; done=s.done; bar.style.width=s.ui.w; barTxt.textContent=s.ui.t; histDisp.innerHTML=s.ui.h; predCard.style.display=s.ui.show; predTxt.textContent=s.ui.text; suggTxt.textContent=s.ui.sug; msg.innerHTML=s.ui.msg; ctr.innerHTML=s.ui.ctrl; prog.style.display=s.ui.prog; histBox.style.display=s.ui.his; bind(); }

      function ui(){
        const last8=hist.slice(-8);
        histDisp.innerHTML=last8.map(v=>`<div class="pill ${v==='P'?'p':'b'}">${v}</div>`).join("");
        const pct = Math.min(Math.round(hist.length/MAX_ENTRIES*100),100);
        bar.style.width = pct+"%";
        barTxt.textContent = hist.length<MAX_ENTRIES ? `${pct}% - Record 25 entries to calculate prediction` : "âœ… Prediction ready!";
        if(pred){ predTxt.textContent=pred; suggTxt.textContent=`ðŸ’¡ Suggested Bet: ${steps[step]}`; predCard.style.display="flex"; } 
        else { predCard.style.display="none"; predTxt.textContent=""; suggTxt.textContent=""; }
        if(!done) msg.innerHTML="";
      }

      function makePred(){
        const trend = hist.slice(-25);
        if(trend.length < MAX_ENTRIES) return;

        let momentum = trend.reduce((acc,val,i)=> acc + (val==='P'?1:-1)*(i+1),0);
        let last = trend[trend.length-1], streak=1;
        for(let i=trend.length-2;i>=0;i--){ if(trend[i]===last) streak++; else break; }
        let reversal = streak >= 3 ? -1 : 1;
        let lead = trend.filter(x=>'P'===x).length - trend.filter(x=>'B'===x).length;
        let seqCounts={};
        for(let i=0;i<=trend.length-3;i++){ let seq = trend.slice(i,i+3).join(''); seqCounts[seq] = (seqCounts[seq]||0)+1; }
        let lastSeq = trend.slice(-3).join(''); let seqBoost = seqCounts[lastSeq]>1 ? 1 : 0;
        let score = momentum*0.4 + reversal*1 + lead*0.2 + seqBoost*0.5;

        pred = score >= 0 ? "Player" : "Banker";
        predCard.style.display="flex";
        predTxt.textContent = pred;
        if(step>=steps.length) step=0;
        suggTxt.textContent = `ðŸ’¡ Suggested Bet: ${steps[step]}`;
      }

      function end(text,type){
        msg.innerHTML=`<div class="${type}">${text}</div>`;
        prog.style.display="none"; histBox.style.display="none"; predCard.style.display="none";
        ctr.innerHTML=`<div class="reset-only"><button class="btn-reset" id="endReset"><i class="fas fa-redo"></i> Reset</button></div>`;
        document.getElementById("endReset").onclick=reset;
        done=true;
      }

      function record(r){
        if(done) return;
        undoStack.push(snap());
        hist.push(r); ui();

        if(hist.length >= MAX_ENTRIES && !pred){ makePred(); return; }

        if(pred){
          const win = (pred==="Player" && r==="P") || (pred==="Banker" && r==="B");
          if(win){ end("ðŸŽ‰ Congrats! You won! Click Reset to play again.","win"); return; }
          step++;
          if(step < steps.length){ suggTxt.textContent = `ðŸ’¡ Suggested Bet: ${steps[step]}`; }
          else { end("âŒ FAIL! Please click Reset to try again.","fail"); return; }
          makePred();
        }
      }

      function undo(){ if(!undoStack.length) return; restore(undoStack.pop()); }

      function reset(){
        hist=[]; step=0; pred=""; done=false; undoStack=[];
        bar.style.width="0%"; barTxt.textContent="0% - Record 25 entries to calculate prediction";
        histDisp.innerHTML=""; predTxt.textContent=""; suggTxt.textContent=""; predCard.style.display="none"; msg.innerHTML=""; prog.style.display=""; histBox.style.display="";
        ctr.innerHTML=`<button class="btn-p" id="btnP"><i class="fas fa-user"></i> Player</button>
                       <button class="btn-b" id="btnB"><i class="fas fa-landmark"></i> Banker</button>
                       <button class="btn-undo" id="btnUndo"><i class="fas fa-undo"></i> Undo</button>
                       <button class="btn-reset" id="btnReset"><i class="fas fa-redo"></i> Reset</button>`;
        bind();
      }

      function bind(){
        const p=document.getElementById("btnP"),b=document.getElementById("btnB"), u=document.getElementById("btnUndo"),r=document.getElementById("btnReset");
        if(p)p.onclick=()=>record("P");
        if(b)b.onclick=()=>record("B");
        if(u)u.onclick=undo;
        if(r)r.onclick=reset;
      }

      document.addEventListener("keydown",e=>{
        if(e.key.toUpperCase()==="P") record("P");
        if(e.key.toUpperCase()==="B") record("B");
        if(e.key==="z"&&(e.ctrlKey||e.metaKey)) undo();
      });

      bind(); ui();
  })();
</script>
</body>
</html>
